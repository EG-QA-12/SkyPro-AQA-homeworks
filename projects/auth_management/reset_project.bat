@echo off
chcp 65001 >nul
echo.
echo ==========================================
echo   –ü–û–õ–ù–´–ô –°–ë–†–û–° –ü–†–û–ï–ö–¢–ê
echo ==========================================
echo.

cd /d "%~dp0"

echo üîÑ –≠—Ç–∞ –æ–ø–µ—Ä–∞—Ü–∏—è –≤—ã–ø–æ–ª–Ω–∏—Ç –ü–û–õ–ù–´–ô –°–ë–†–û–° –ø—Ä–æ–µ–∫—Ç–∞:
echo    1. –£–¥–∞–ª–∏—Ç –±–∞–∑—É –¥–∞–Ω–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
echo    2. –£–¥–∞–ª–∏—Ç –≤—Å–µ —Ñ–∞–π–ª—ã –∫—É–∫–æ–≤
echo    3. –°–æ–∑–¥–∞—Å—Ç –Ω–æ–≤—É—é –ø—É—Å—Ç—É—é –±–∞–∑—É
echo    4. –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –∏–∑ CSV
echo.
echo ‚ö†Ô∏è  –í–ù–ò–ú–ê–ù–ò–ï: –í—Å–µ –¥–∞–Ω–Ω—ã–µ –±—É–¥—É—Ç –ø–æ—Ç–µ—Ä—è–Ω—ã –Ω–∞–≤—Å–µ–≥–¥–∞!
echo.
set /p choice="–í–≤–µ–¥–∏—Ç–µ 'RESET' –¥–ª—è –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è: "
if not "%choice%"=="RESET" (
    echo –û–ø–µ—Ä–∞—Ü–∏—è –æ—Ç–º–µ–Ω–µ–Ω–∞.
    pause
    exit /b 0
)

echo.
echo üóëÔ∏è  –®–∞–≥ 1/4: –£–¥–∞–ª–µ–Ω–∏–µ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö...
if exist "data\users.db" (
    del "data\users.db"
    echo ‚úÖ –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö —É–¥–∞–ª–µ–Ω–∞
) else (
    echo ‚ÑπÔ∏è  –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö –Ω–µ –Ω–∞–π–¥–µ–Ω–∞
)

echo.
echo üóëÔ∏è  –®–∞–≥ 2/4: –£–¥–∞–ª–µ–Ω–∏–µ —Ñ–∞–π–ª–æ–≤ –∫—É–∫–æ–≤...
if exist "data\*_cookies.json" (
    del "data\*_cookies.json"
    echo ‚úÖ –§–∞–π–ª—ã –∫—É–∫–æ–≤ —É–¥–∞–ª–µ–Ω—ã
) else (
    echo ‚ÑπÔ∏è  –§–∞–π–ª—ã –∫—É–∫–æ–≤ –Ω–µ –Ω–∞–π–¥–µ–Ω—ã
)

echo.
echo üîÑ –®–∞–≥ 3/4: –°–æ–∑–¥–∞–Ω–∏–µ –Ω–æ–≤–æ–π –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö...
python -c "
import sys, os
sys.path.insert(0, '.')
from src.database import DatabaseManager
try:
    db = DatabaseManager()
    print('‚úÖ –ù–æ–≤–∞—è –±–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö —Å–æ–∑–¥–∞–Ω–∞')
except Exception as e:
    print(f'‚ùå –û—à–∏–±–∫–∞ —Å–æ–∑–¥–∞–Ω–∏—è –ë–î: {e}')
    exit(1)
"

if %ERRORLEVEL% neq 0 (
    echo ‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö!
    pause
    exit /b 1
)

echo.
echo üîÑ –®–∞–≥ 4/4: –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π...
if exist "data\bulk_users.csv" (
    echo üìÅ –ò–º–ø–æ—Ä—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –∏–∑ CSV...
    python scripts\init_users.py
    
    if %ERRORLEVEL% equ 0 (
        echo ‚úÖ –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ —É—Å–ø–µ—à–Ω–æ –∏–º–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞–Ω—ã
    ) else (
        echo ‚ö†Ô∏è  –í–æ–∑–º–æ–∂–Ω—ã –æ—à–∏–±–∫–∏ –ø—Ä–∏ –∏–º–ø–æ—Ä—Ç–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
    )
) else (
    echo ‚ö†Ô∏è  –§–∞–π–ª bulk_users.csv –Ω–µ –Ω–∞–π–¥–µ–Ω, –∏–º–ø–æ—Ä—Ç –ø—Ä–æ–ø—É—â–µ–Ω
)

echo.
echo ==========================================
echo   –ü–†–û–ï–ö–¢ –ü–û–õ–ù–û–°–¢–¨–Æ –°–ë–†–û–®–ï–ù!
echo ==========================================
echo   –°—Ç–∞—Ç—É—Å:
echo   ‚úÖ –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö: –æ—á–∏—â–µ–Ω–∞ –∏ –ø–µ—Ä–µ—Å–æ–∑–¥–∞–Ω–∞
echo   ‚úÖ –ö—É–∫–∏: —É–¥–∞–ª–µ–Ω—ã
echo   ‚úÖ –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏: –∏–º–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞–Ω—ã –∏–∑ CSV
echo.
echo   –°–ª–µ–¥—É—é—â–∏–µ —à–∞–≥–∏:
echo   1. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π: python scripts\view_users.py
echo   2. –í—ã–ø–æ–ª–Ω–∏—Ç—å –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—é: run_bulk_auth_headless.bat
echo ==========================================
pause
