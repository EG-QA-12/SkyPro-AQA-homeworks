# End-to-End (E2E) тесты

## Описание

Этот модуль содержит end-to-end тесты для проверки бизнес-логики и пользовательских сценариев веб-приложения. Тесты написаны с использованием Playwright и Pytest.

## Структура

```
e2e/
├── config/                    # Конфигурация E2E тестов
│   ├── __init__.py
│   ├── e2e_config.py         # Основной конфиг
│   └── README.md
├── integration/              # Интеграционные тесты
│   └── test_question_workflow.py
├── workflow_fixtures.py      # Фикстуры для workflow тестов
└── README.md                # Эта документация
```

## Основные компоненты

### integration/

Содержит end-to-end тесты для комплексных сценариев:
- Полный жизненный цикл вопросов и ответов
- Интеграция между различными ролями пользователей
- Сквозные бизнес-процессы

### config/

Модуль конфигурации для e2e тестов:
- Настройки путей и окружения
- Управление данными пользователей
- Конфигурация тестового окружения

### workflow_fixtures.py

Фикстуры и утилиты для workflow тестов:
- Контекст выполнения тестов
- Управление состоянием между тестами
- Вспомогательные функции

## Запуск тестов

### Все тесты

```bash
pytest tests/e2e/ -v
```

### Конкретный workflow

```bash
pytest tests/e2e/integration/test_question_workflow.py -v
```

### С метками

```bash
pytest tests/e2e/ -v -m workflow
```

## Добавление новых тестов

1. Создайте файл в соответствующей директории:
   - `integration/` для сквозных сценариев
   - `auth/` для тестов авторизации
   - `ui/` для тестов интерфейса

2. Следуйте структуре существующих тестов:
   ```python
   @pytest.mark.workflow
   def test_scenario_name(context, page):
       """
       Описание сценария
       """
       # Подготовка
       context.setup_something()
       
       # Действие
       page.do_something()
       
       # Проверка
       assert something_happened
   ```

3. Используйте существующие фикстуры или добавьте новые в `workflow_fixtures.py`

4. Добавьте необходимую документацию

## Написание тестов

### Основные принципы

1. **Изоляция**:
   - Каждый тест должен быть независимым
   - Используйте фикстуры для настройки окружения
   - Очищайте данные после тестов

2. **Читаемость**:
   - Понятные имена тестов
   - Документация (docstrings)
   - Комментарии для сложной логики

3. **Надежность**:
   - Обработка асинхронных операций
   - Ожидание элементов и состояний
   - Проверка предусловий

### Работа с фикстурами

```python
@pytest.fixture
def workflow_context():
    """Создает контекст для workflow тестов"""
    context = WorkflowContext()
    yield context
    context.cleanup()

def test_example(workflow_context, page):
    workflow_context.setup()
    # Тестовая логика
```

## Отладка тестов

### Режим разработки

```bash
# Запуск в headed режиме
pytest tests/e2e/ --headed -v

# Замедление выполнения
pytest tests/e2e/ --slowmo 1000

# Дебаг режим
pytest tests/e2e/ --pdb
```

### Логирование

```python
import logging
logger = logging.getLogger(__name__)

def test_something():
    logger.debug("Детальная информация")
    logger.info("Важный шаг")
    logger.warning("Предупреждение")
```

## Безопасность

- Не храните чувствительные данные в тестах
- Используйте переменные окружения
- Изолируйте тестовое окружение

## Советы

1. **Стабильность**:
   - Используйте надежные селекторы
   - Добавляйте явные ожидания
   - Проверяйте предусловия

2. **Производительность**:
   - Группируйте похожие тесты
   - Переиспользуйте состояние браузера
   - Оптимизируйте инициализацию

3. **Поддерживаемость**:
   - Следуйте Page Object паттерну
   - Выносите общую логику в фикстуры
   - Регулярно обновляйте тесты
