# üõ°Ô∏è –°–ò–°–¢–ï–ú–ê –ê–í–¢–û–†–ò–ó–ê–¶–ò–ò

## üìã –û–ë–ó–û–†

–ï–¥–∏–Ω–∞—è —Å–∏—Å—Ç–µ–º–∞ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–µ–π –¥–ª—è —Ñ—Ä–µ–π–º–≤–æ—Ä–∫–∞ –∞–≤—Ç–æ—Ç–µ—Å—Ç–æ–≤, –æ–±—ä–µ–¥–∏–Ω—è—é—â–∞—è —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å –Ω–µ—Å–∫–æ–ª—å–∫–∏—Ö –ø—Ä–µ–¥—ã–¥—É—â–∏—Ö —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–π –∏ –æ–±–µ—Å–ø–µ—á–∏–≤–∞—é—â–∞—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Å–µ—Å—Å–∏–æ–Ω–Ω—ã–º–∏ –∫—É–∫–∞–º–∏.

## üèóÔ∏è –ê–†–•–ò–¢–ï–ö–¢–£–†–ê

### –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤
```
framework/auth/
‚îú‚îÄ‚îÄ __init__.py              # –¢–æ—á–∫–∞ –≤—Ö–æ–¥–∞ –º–æ–¥—É–ª—è
‚îú‚îÄ‚îÄ auth_manager.py          # –û—Å–Ω–æ–≤–Ω–æ–π –º–µ–Ω–µ–¥–∂–µ—Ä –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏
‚îú‚îÄ‚îÄ cookie_provider.py       # –ü—Ä–æ–≤–∞–π–¥–µ—Ä –∫—É–∫
‚îú‚îÄ‚îÄ auth_utils.py           # –í—Å–ø–æ–º–æ–≥–∞—Ç–µ–ª—å–Ω—ã–µ —É—Ç–∏–ª–∏—Ç—ã
‚îî‚îÄ‚îÄ README.md               # –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è
```

### –û—Å–Ω–æ–≤–Ω—ã–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã

#### AuthManager
–û—Å–Ω–æ–≤–Ω–æ–π –∫–ª–∞—Å—Å –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–µ–π —Å –ø–æ–¥–¥–µ—Ä–∂–∫–æ–π:
- **–ö—ç—à–∏—Ä–æ–≤–∞–Ω–∏—è –∫—É–∫** - –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –∏ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ —Å–µ—Å—Å–∏–π
- **–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–≥–æ API-–ª–æ–≥–∏–Ω–∞** - –ø–æ–ª—É—á–µ–Ω–∏–µ –∫—É–∫ —á–µ—Ä–µ–∑ —É—á–µ—Ç–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ
- **–í–∞–ª–∏–¥–∞—Ü–∏–∏ —Å–µ—Å—Å–∏–π** - –ø—Ä–æ–≤–µ—Ä–∫–∞ –∞–∫—Ç—É–∞–ª—å–Ω–æ—Å—Ç–∏ –∫—É–∫
- **Retry –ª–æ–≥–∏–∫–∏** - –ø–æ–≤—Ç–æ—Ä–Ω—ã–µ –ø–æ–ø—ã—Ç–∫–∏ –ø—Ä–∏ –æ—à–∏–±–∫–∞—Ö 401/419

#### CookieProvider
–ü—Ä–æ–≤–∞–π–¥–µ—Ä –∫—É–∫ —Å –ø–æ–¥–¥–µ—Ä–∂–∫–æ–π —Ä–∞–∑–ª–∏—á–Ω—ã—Ö –∏—Å—Ç–æ—á–Ω–∏–∫–æ–≤:
- **–ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è** - `SESSION_COOKIE_{ROLE}` –∏–ª–∏ `SESSION_COOKIE`
- **–õ–æ–∫–∞–ª—å–Ω—ã–µ —Ñ–∞–π–ª—ã** - `cookies/{role}_session.txt` –∏–ª–∏ `cookies/{role}_cookies.json`
- **API-–ª–æ–≥–∏–Ω** - –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –ª–æ–≥–∏–Ω —á–µ—Ä–µ–∑ —É—á–µ—Ç–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ

#### AuthUtils
–í—Å–ø–æ–º–æ–≥–∞—Ç–µ–ª—å–Ω—ã–µ —É—Ç–∏–ª–∏—Ç—ã –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å –∫—É–∫–∞–º–∏:
- **–í–∞–ª–∏–¥–∞—Ü–∏—è –∫—É–∫** - –ø—Ä–æ–≤–µ—Ä–∫–∞ —Ñ–æ—Ä–º–∞—Ç–∞ –∏ –∞–∫—Ç—É–∞–ª—å–Ω–æ—Å—Ç–∏
- **–°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ/–∑–∞–≥—Ä—É–∑–∫–∞** - —Ä–∞–±–æ—Ç–∞ —Å –ª–æ–∫–∞–ª—å–Ω—ã–º–∏ —Ñ–∞–π–ª–∞–º–∏
- **–û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫** - —Ü–µ–Ω—Ç—Ä–∞–ª–∏–∑–æ–≤–∞–Ω–Ω–∞—è –ª–æ–≥–∏–∫–∞ –∏—Å–∫–ª—é—á–µ–Ω–∏–π

## üîê –ò–°–¢–û–ß–ù–ò–ö–ò –ê–í–¢–û–†–ò–ó–ê–¶–ò–ò

### 1. –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è (–≤—ã—Å—à–∏–π –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç)
```env
# –î–ª—è –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–π —Ä–æ–ª–∏
SESSION_COOKIE_ADMIN=–≤–∞—à–∞_–∞–¥–º–∏–Ω—Å–∫–∞—è_–∫—É–∫–∞
SESSION_COOKIE_MODERATOR=–≤–∞—à–∞_–∫—É–∫–∞_–º–æ–¥–µ—Ä–∞—Ç–æ—Ä–∞

# –û–±—â–∞—è –∫—É–∫–∞ –¥–ª—è –≤—Å–µ—Ö —Ä–æ–ª–µ–π
SESSION_COOKIE=–æ–±—â–∞—è_–∫—É–∫–∞_–¥–ª—è_–≤—Å–µ—Ö
```

### 2. –õ–æ–∫–∞–ª—å–Ω—ã–µ —Ñ–∞–π–ª—ã
```
cookies/
‚îú‚îÄ‚îÄ admin_session.txt          # –¢–µ–∫—Å—Ç–æ–≤—ã–π —Ñ–∞–π–ª —Å –∫—É–∫–æ–π
‚îú‚îÄ‚îÄ moderator_session.txt     # –¢–µ–∫—Å—Ç–æ–≤—ã–π —Ñ–∞–π–ª —Å –∫—É–∫–æ–π
‚îú‚îÄ‚îÄ user_session.txt           # –¢–µ–∫—Å—Ç–æ–≤—ã–π —Ñ–∞–π–ª —Å –∫—É–∫–æ–π
‚îú‚îÄ‚îÄ admin_cookies.json         # JSON —Ñ–∞–π–ª Playwright —Ñ–æ—Ä–º–∞—Ç–∞
‚îú‚îÄ‚îÄ moderator_cookies.json     # JSON —Ñ–∞–π–ª Playwright —Ñ–æ—Ä–º–∞—Ç–∞
‚îî‚îÄ‚îÄ user_cookies.json          # JSON —Ñ–∞–π–ª Playwright —Ñ–æ—Ä–º–∞—Ç–∞
```

### 3. API-–ª–æ–≥–∏–Ω (–Ω–∏–∑—à–∏–π –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç)
```env
# –£—á–µ—Ç–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –¥–ª—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–≥–æ –ª–æ–≥–∏–Ω–∞
API_USERNAME_ADMIN=admin@example.com
API_PASSWORD_ADMIN=–≤–∞—à_–ø–∞—Ä–æ–ª—å
API_USERNAME_MODERATOR=moder@example.com
API_PASSWORD_MODERATOR=–≤–∞—à_–ø–∞—Ä–æ–ª—å
```

## üöÄ –ò–°–ü–û–õ–¨–ó–û–í–ê–ù–ò–ï

### –ë–∞–∑–æ–≤–æ–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ
```python
from framework.auth import AuthManager, get_session_cookie

# –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ AuthManager –Ω–∞–ø—Ä—è–º—É—é
manager = AuthManager()
admin_cookie = manager.get_session_cookie("admin")

# –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ —É–¥–æ–±–Ω—ã—Ö —Ñ—É–Ω–∫—Ü–∏–π
admin_cookie = get_session_cookie("admin")
```

### SmartAuthManager –¥–ª—è Playwright —Ç–µ—Å—Ç–æ–≤
```python
from framework.utils.smart_auth_manager import SmartAuthManager

# –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è —É–º–Ω–æ–≥–æ –º–µ–Ω–µ–¥–∂–µ—Ä–∞ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏
auth_manager = SmartAuthManager()

# –ü–æ–ª—É—á–µ–Ω–∏–µ –≤–∞–ª–∏–¥–Ω–æ–π –∫—É–∫–∏ —Å –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–π –ø—Ä–æ–≤–µ—Ä–∫–æ–π –∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ–º
session_cookie = auth_manager.get_valid_session_cookie(role="admin")

# –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –≤ Playwright –∫–æ–Ω—Ç–µ–∫—Å—Ç–µ
context.add_cookies([session_cookie])
```

### –î–æ–º–µ–Ω-–∑–∞–≤–∏—Å–∏–º–∞—è –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è –≤ Playwright —Ç–µ—Å—Ç–∞—Ö
```python
# –í conftest.py –¥–ª—è multi-domain —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è
@pytest.fixture
def domain_aware_authenticated_context(browser, multi_domain_context):
    domain_name, base_url = multi_domain_context

    context = browser.new_context(...)
    # –ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è –¥–ª—è –í–°–ï–• –¥–æ–º–µ–Ω–æ–≤ (bll, expert, bonus, ca, cp)
    auth_manager = SmartAuthManager()
    session_cookie = auth_manager.get_valid_session_cookie(role="admin")

    if session_cookie:
        context.add_cookies([session_cookie])
        print(f"‚úÖ –ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è –¥–ª—è –¥–æ–º–µ–Ω–∞ {domain_name} –≤—ã–ø–æ–ª–Ω–µ–Ω–∞")

    yield context
    context.close()
```

### –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –≤ —Ç–µ—Å—Ç–∞—Ö
```python
import pytest
from framework.test_bases.api_test_base import APITestBase

class TestWithAuth(APITestBase):
    def test_admin_operation(self):
        """–¢–µ—Å—Ç —Å –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–π –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–µ–π."""
        # self.admin_client —É–∂–µ –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω
        result = self.admin_client.some_admin_operation()
        assert result is True
```

### –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –≤ —Å–∫—Ä–∏–ø—Ç–∞—Ö
```python
from framework.auth import get_auth_cookies

# –ü–æ–ª—É—á–µ–Ω–∏–µ –∫—É–∫ –≤ —Ñ–æ—Ä–º–∞—Ç–µ Playwright
playwright_cookies = get_auth_cookies("admin")
# –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –≤ Playwright –∫–æ–Ω—Ç–µ–∫—Å—Ç–µ
context.add_cookies(playwright_cookies)
```

## üîß –ù–ê–°–¢–†–û–ô–ö–ê

### –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –≤—Ä–µ–º–µ–Ω–∏ –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏—è
```python
from framework.auth import AuthManager

# –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –≤—Ä–µ–º–µ–Ω–∏ –∂–∏–∑–Ω–∏ –∫—ç—à–∞ (–≤ —Å–µ–∫—É–Ω–¥–∞—Ö)
manager = AuthManager(cache_timeout=600)  # 10 –º–∏–Ω—É—Ç
```

### –ü—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∫—É–∫
```python
from framework.auth import AuthManager

manager = AuthManager()
# –ü—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∫—É–∫–∏
fresh_cookie = manager.get_session_cookie("admin", force_refresh=True)
```

### –û—á–∏—Å—Ç–∫–∞ –∫—ç—à–∞
```python
from framework.auth import AuthManager

manager = AuthManager()
# –û—á–∏—Å—Ç–∫–∞ –∫—ç—à–∞ –¥–ª—è –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–π —Ä–æ–ª–∏
manager.clear_cache("admin")

# –û—á–∏—Å—Ç–∫–∞ –≤—Å–µ–≥–æ –∫—ç—à–∞
manager.clear_cache()
```

## üîÑ –ê–í–¢–û–ú–ê–¢–ò–ß–ï–°–ö–ò–ô API-–õ–û–ì–ò–ù

### –ù–∞—Å—Ç—Ä–æ–π–∫–∞ —É—á–µ—Ç–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö
```env
# .env —Ñ–∞–π–ª
API_USERNAME_ADMIN=admin@example.com
API_PASSWORD_ADMIN=–≤–∞—à_–ø–∞—Ä–æ–ª—å_–∞–¥–º–∏–Ω–∞
API_USERNAME_MODERATOR=moder@example.com
API_PASSWORD_MODERATOR=–≤–∞—à_–ø–∞—Ä–æ–ª—å_–º–æ–¥–µ—Ä–∞—Ç–æ—Ä–∞
```

### –ü—Ä–æ—Ü–µ—Å—Å –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–≥–æ –ª–æ–≥–∏–Ω–∞
1. **–ü—Ä–æ–≤–µ—Ä–∫–∞ –∫—ç—à–∞** - –ø–æ–∏—Å–∫ –≤–∞–ª–∏–¥–Ω–æ–π –∫—É–∫–∏
2. **ENV –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ** - –ø—Ä–æ–≤–µ—Ä–∫–∞ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –æ–∫—Ä—É–∂–µ–Ω–∏—è
3. **–õ–æ–∫–∞–ª—å–Ω—ã–µ —Ñ–∞–π–ª—ã** - –ø–æ–∏—Å–∫ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–Ω—ã—Ö –∫—É–∫
4. **API-–ª–æ–≥–∏–Ω** - –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –ª–æ–≥–∏–Ω —á–µ—Ä–µ–∑ —É—á–µ—Ç–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ
5. **–°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –∫—É–∫–∏** - –∑–∞–ø–∏—Å—å –≤ –ª–æ–∫–∞–ª—å–Ω—ã–π —Ñ–∞–π–ª –¥–ª—è –ø–æ–≤—Ç–æ—Ä–Ω–æ–≥–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è

## üîç –í–ê–õ–ò–î–ê–¶–ò–Ø –°–ï–°–°–ò–ô

### –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞
```python
from framework.auth import AuthManager

manager = AuthManager()
# –ö—ç—à –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø—Ä–æ–≤–µ—Ä—è–µ—Ç—Å—è –Ω–∞ –≤–∞–ª–∏–¥–Ω–æ—Å—Ç—å
is_valid = manager.validate_current_session("admin")
```

### –†—É—á–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ –∫—É–∫–∏
```python
from framework.auth import validate_cookie

cookie = "–≤–∞—à–∞_–∫—É–∫–∞"
if validate_cookie(cookie):
    print("–ö—É–∫–∞ –≤–∞–ª–∏–¥–Ω–∞")
else:
    print("–ö—É–∫–∞ –Ω–µ–≤–∞–ª–∏–¥–Ω–∞")
```

## üéØ –õ–£–ß–®–ò–ï –ü–†–ê–ö–¢–ò–ö–ò

### 1. –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –≤ API —Ç–µ—Å—Ç–∞—Ö
```python
# ‚úÖ –•–æ—Ä–æ—à–æ - –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –±–∞–∑–æ–≤—ã—Ö –∫–ª–∞—Å—Å–æ–≤
from framework.test_bases.api_test_base import APITestBase

class TestQuestions(APITestBase):
    def test_create_question(self):
        result = self.admin_client.create_question("–¢–µ—Å—Ç–æ–≤—ã–π –≤–æ–ø—Ä–æ—Å")
        assert result is True

# ‚ùå –ü–ª–æ—Ö–æ - —Ä—É—á–Ω–æ–µ —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–µ–π
import requests
from framework.utils.auth_utils import get_session_cookie

def test_create_question():
    cookie = get_session_cookie("admin")
    session = requests.Session()
    session.cookies.set("test_joint_session", cookie)
    # ... –æ—Å—Ç–∞–ª—å–Ω–æ–π –∫–æ–¥
```

### 2. –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –≤ Playwright —Ç–µ—Å—Ç–∞—Ö
```python
# ‚úÖ –•–æ—Ä–æ—à–æ - –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ SmartAuthManager –¥–ª—è GUI —Ç–µ—Å—Ç–æ–≤
from framework.utils.smart_auth_manager import SmartAuthManager

@pytest.fixture
def authenticated_context(browser):
    context = browser.new_context(...)
    auth_manager = SmartAuthManager()
    session_cookie = auth_manager.get_valid_session_cookie(role="admin")
    if session_cookie:
        context.add_cookies([session_cookie])
    yield context
    context.close()

# ‚úÖ –•–æ—Ä–æ—à–æ - –¥–æ–º–µ–Ω-–∑–∞–≤–∏—Å–∏–º–∞—è –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è –¥–ª—è multi-domain —Ç–µ—Å—Ç–æ–≤
@pytest.fixture
def domain_aware_authenticated_context(browser, multi_domain_context):
    domain_name, base_url = multi_domain_context
    context = browser.new_context(...)
    # –ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è –¥–ª—è –í–°–ï–• –¥–æ–º–µ–Ω–æ–≤
    auth_manager = SmartAuthManager()
    session_cookie = auth_manager.get_valid_session_cookie(role="admin")
    if session_cookie:
        context.add_cookies([session_cookie])
    yield context
    context.close()

# ‚ùå –ü–ª–æ—Ö–æ - —Å—Ç–∞—Ç–∏—á–µ—Å–∫–∞—è –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è –±–µ–∑ –ø—Ä–æ–≤–µ—Ä–∫–∏ –≤–∞–ª–∏–¥–Ω–æ—Å—Ç–∏
@pytest.fixture
def authenticated_context(browser):
    context = browser.new_context(...)
    # –°—Ç–∞—Ç–∏—á–µ—Å–∫–∞—è –∫—É–∫–∞ –±–µ–∑ –ø—Ä–æ–≤–µ—Ä–∫–∏ —Å—Ä–æ–∫–∞ –¥–µ–π—Å—Ç–≤–∏—è
    context.add_cookies([{"name": "session", "value": "old_cookie", ...}])
    yield context
    context.close()
```

### 2. –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –æ–∫—Ä—É–∂–µ–Ω–∏—è
```bash
# ‚úÖ –•–æ—Ä–æ—à–æ - –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ .env —Ñ–∞–π–ª–∞
echo "SESSION_COOKIE_ADMIN=–≤–∞—à–∞_–∫—É–∫–∞" > .env

# ‚ùå –ü–ª–æ—Ö–æ - –∂–µ—Å—Ç–∫–æ–µ –∫–æ–¥–∏—Ä–æ–≤–∞–Ω–∏–µ –∫—É–∫
# –ù–µ —Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è —Ö—Ä–∞–Ω–∏—Ç—å –∫—É–∫–∏ –≤ –∫–æ–¥–µ
```

### 3. –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫
```python
# ‚úÖ –•–æ—Ä–æ—à–æ - –¥–æ–≤–µ—Ä–∏–µ —Å–∏—Å—Ç–µ–º–µ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏
from framework.auth import get_session_cookie

try:
    cookie = get_session_cookie("admin")
    if not cookie:
        raise ValueError("–ù–µ —É–¥–∞–ª–æ—Å—å –ø–æ–ª—É—á–∏—Ç—å –∫—É–∫—É –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞")
except Exception as e:
    logger.error(f"–û—à–∏–±–∫–∞ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏: {e}")
    raise

# ‚ùå –ü–ª–æ—Ö–æ - —Å–ª–æ–∂–Ω–∞—è –ª–æ–≥–∏–∫–∞ –æ–±—Ä–∞–±–æ—Ç–∫–∏ –∫—É–∫
# –°–∏—Å—Ç–µ–º–∞ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏ —É–∂–µ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç —ç—Ç–æ
```

## üîß –†–ï–®–ï–ù–ò–ï –ü–†–û–ë–õ–ï–ú

### –ü—Ä–æ–±–ª–µ–º–∞ 1: "–ö—É–∫–∞ –Ω–µ –Ω–∞–π–¥–µ–Ω–∞"
**–°–∏–º–ø—Ç–æ–º—ã:**
```
WARNING: –ù–µ —É–¥–∞–ª–æ—Å—å –ø–æ–ª—É—á–∏—Ç—å –∫—É–∫—É –¥–ª—è —Ä–æ–ª–∏ 'admin'
```

**–†–µ—à–µ–Ω–∏—è:**
1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è
2. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–∫–∞–ª—å–Ω—ã–µ —Ñ–∞–π–ª—ã –∫—É–∫
3. –£–±–µ–¥–∏—Ç–µ—Å—å —á—Ç–æ —É—á–µ—Ç–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –¥–ª—è API-–ª–æ–≥–∏–Ω–∞ –∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã
4. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø—Ä–∞–≤–∞ –¥–æ—Å—Ç—É–ø–∞ –∫ —Ñ–∞–π–ª–∞–º

### –ü—Ä–æ–±–ª–µ–º–∞ 2: "–ù–µ–≤–∞–ª–∏–¥–Ω–∞—è –∫—É–∫–∞"
**–°–∏–º–ø—Ç–æ–º—ã:**
```
ERROR: –ö—É–∫–∞ —Å–ª–∏—à–∫–æ–º –∫–æ—Ä–æ—Ç–∫–∞—è –∏–ª–∏ —Å–æ–¥–µ—Ä–∂–∏—Ç –ø—Ä–æ–±–µ–ª—ã
```

**–†–µ—à–µ–Ω–∏—è:**
1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Ñ–æ—Ä–º–∞—Ç –∫—É–∫–∏
2. –£–±–µ–¥–∏—Ç–µ—Å—å —á—Ç–æ –∫—É–∫–∞ –Ω–µ –∏—Å—Ç–µ–∫–ª–∞
3. –ü–æ–ª—É—á–∏—Ç–µ –Ω–æ–≤—É—é –∫—É–∫—É —á–µ—Ä–µ–∑ API-–ª–æ–≥–∏–Ω

### –ü—Ä–æ–±–ª–µ–º–∞ 3: "API-–ª–æ–≥–∏–Ω –Ω–µ —É–¥–∞–ª—Å—è"
**–°–∏–º–ø—Ç–æ–º—ã:**
```
ERROR: API-–ª–æ–≥–∏–Ω –¥–ª—è —Ä–æ–ª–∏ 'admin' –Ω–µ —É–¥–∞–ª—Å—è
```

**–†–µ—à–µ–Ω–∏—è:**
1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —É—á–µ—Ç–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –≤ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –æ–∫—Ä—É–∂–µ–Ω–∏—è
2. –£–±–µ–¥–∏—Ç–µ—Å—å —á—Ç–æ —É—á–µ—Ç–Ω–∞—è –∑–∞–ø–∏—Å—å –∞–∫—Ç–∏–≤–Ω–∞
3. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Å–µ—Ç–µ–≤–æ–µ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ
4. –û–±—Ä–∞—Ç–∏—Ç–µ—Å—å –∫ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä—É —Å–∏—Å—Ç–µ–º—ã

### –ü—Ä–æ–±–ª–µ–º–∞ 4: "–ë—É—Ä–≥–µ—Ä-–º–µ–Ω—é –Ω–µ –æ—Ç–æ–±—Ä–∞–∂–∞–µ—Ç—Å—è –≤ Playwright —Ç–µ—Å—Ç–∞—Ö"
**–°–∏–º–ø—Ç–æ–º—ã:**
```
WARNING: –ù–∏ –æ–¥–Ω–∞ –∫–Ω–æ–ø–∫–∞ –º–µ–Ω—é –Ω–µ –≤–∏–¥–∏–º–∞
TimeoutError: Locator.click: Timeout 30000ms exceeded
```

**–ü—Ä–∏—á–∏–Ω–∞:**
–ù–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω–∞—è –¥–æ–º–µ–Ω-–∑–∞–≤–∏—Å–∏–º–∞—è –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è - –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è —Ä–∞–±–æ—Ç–∞–ª–∞ —Ç–æ–ª—å–∫–æ –Ω–∞ bll/expert –¥–æ–º–µ–Ω–∞—Ö, –Ω–æ –Ω–µ –Ω–∞ bonus/ca/cp.

**–†–µ—à–µ–Ω–∏–µ:**
```python
# –í conftest.py - –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è –¥–ª—è –í–°–ï–• –¥–æ–º–µ–Ω–æ–≤
auth_manager = SmartAuthManager()
session_cookie = auth_manager.get_valid_session_cookie(role="admin")
if session_cookie:
    context.add_cookies([session_cookie])
# –£–±—Ä–∞—Ç—å —É—Å–ª–æ–≤–∏–µ if domain_name in ['bll', 'expert']
```

**–†–µ–∑—É–ª—å—Ç–∞—Ç:**
- –í—Å–µ 5 –¥–æ–º–µ–Ω–æ–≤ (bll, expert, bonus, ca, cp) —Ç–µ–ø–µ—Ä—å –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω—ã
- –ë—É—Ä–≥–µ—Ä-–º–µ–Ω—é –æ—Ç–æ–±—Ä–∞–∂–∞–µ—Ç—Å—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ –Ω–∞ –≤—Å–µ—Ö –¥–æ–º–µ–Ω–∞—Ö
- –¢–µ—Å—Ç—ã –ø—Ä–æ—Ö–æ–¥—è—Ç –Ω–∞ –≤—Å–µ—Ö –¥–æ–º–µ–Ω–∞—Ö

## üìä –ú–û–ù–ò–¢–û–†–ò–ù–ì –ò –î–ò–ê–ì–ù–û–°–¢–ò–ö–ê

### –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ
–°–∏—Å—Ç–µ–º–∞ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ Python:
```python
import logging
logging.basicConfig(level=logging.DEBUG)
```

### –ú–µ—Ç—Ä–∏–∫–∏ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏
```python
# –í—Ä–µ–º—è –ø–æ–ª—É—á–µ–Ω–∏—è –∫—É–∫–∏ –∏–∑ –∫—ç—à–∞: ~1ms
# –í—Ä–µ–º—è –ø–æ–ª—É—á–µ–Ω–∏—è –∫—É–∫–∏ –∏–∑ ENV: ~5ms
# –í—Ä–µ–º—è –ø–æ–ª—É—á–µ–Ω–∏—è –∫—É–∫–∏ –∏–∑ —Ñ–∞–π–ª–∞: ~10ms
# –í—Ä–µ–º—è API-–ª–æ–≥–∏–Ω–∞: ~500ms-2000ms
```

### –î–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞ –ø—Ä–æ–±–ª–µ–º
```bash
# –ó–∞–ø—É—Å–∫ —Å –æ—Ç–ª–∞–¥–æ—á–Ω—ã–º–∏ –ª–æ–≥–∞–º–∏
pytest tests/auth/test_api_mass_authorization.py --log-cli-level=DEBUG
```

## üîí –ë–ï–ó–û–ü–ê–°–ù–û–°–¢–¨

### –•—Ä–∞–Ω–µ–Ω–∏–µ –∫—É–∫
1. **–ù–∏–∫–æ–≥–¥–∞ –Ω–µ –∫–æ–º–º–∏—Ç—å—Ç–µ –∫—É–∫–∏** –≤ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π
2. **–ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ .gitignore** –¥–ª—è —Ñ–∞–π–ª–æ–≤ –∫—É–∫
3. **–•—Ä–∞–Ω–∏—Ç–µ –∫—É–∫–∏ –≤ .env** –∏–ª–∏ –æ—Ç–¥–µ–ª—å–Ω—ã—Ö —Ñ–∞–π–ª–∞—Ö –≤–Ω–µ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—è

### –†–æ—Ç–∞—Ü–∏—è –∫—É–∫
```python
from framework.auth import AuthManager

# –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è —Ä–æ—Ç–∞—Ü–∏—è –ø—Ä–∏ –∏—Å—Ç–µ—á–µ–Ω–∏–∏ —Å—Ä–æ–∫–∞
manager = AuthManager(cache_timeout=300)  # 5 –º–∏–Ω—É—Ç
```

## üìö –î–û–ü–û–õ–ù–ò–¢–ï–õ–¨–ù–´–ï –†–ï–°–£–†–°–´

### –°–≤—è–∑–∞–Ω–Ω—ã–µ –¥–æ–∫—É–º–µ–Ω—Ç—ã
- [–ù–∞–ø–∏—Å–∞–Ω–∏–µ —Ç–µ—Å—Ç–æ–≤](../TESTING/WRITING_TESTS.md) - –∫–∞–∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—é –≤ —Ç–µ—Å—Ç–∞—Ö
- [API —Å–ø—Ä–∞–≤–æ—á–Ω–∏–∫](../REFERENCES/API_REFERENCE.md) - –ø–æ–ª–Ω–æ–µ –æ–ø–∏—Å–∞–Ω–∏–µ –∫–ª–∏–µ–Ω—Ç–æ–≤
- [–õ—É—á—à–∏–µ –ø—Ä–∞–∫—Ç–∏–∫–∏](../TESTING/BEST_PRACTICES.md) - —Å–æ–≤–µ—Ç—ã –ø–æ —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ–º—É –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é
- [Burger Menu Params](../TESTING/burger_menu_params.md) - —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –±—É—Ä–≥–µ—Ä-–º–µ–Ω—é –Ω–∞ –≤—Å–µ—Ö –¥–æ–º–µ–Ω–∞—Ö

### –ü—Ä–∏–º–µ—Ä—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è
- [–ü—Ä–∏–º–µ—Ä—ã —Ç–µ—Å—Ç–æ–≤ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏](../REFERENCES/EXAMPLES.md#auth-tests)
- [–ü—Ä–∏–º–µ—Ä—ã API –∫–ª–∏–µ–Ω—Ç–æ–≤](../REFERENCES/EXAMPLES.md#api-clients)
- [–ü—Ä–∏–º–µ—Ä—ã UI —Ç–µ—Å—Ç–æ–≤](../REFERENCES/EXAMPLES.md#ui-tests)

## ü§ù –ü–û–î–î–ï–†–ñ–ö–ê

–ü—Ä–∏ –≤–æ–∑–Ω–∏–∫–Ω–æ–≤–µ–Ω–∏–∏ –ø—Ä–æ–±–ª–µ–º —Å –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–µ–π:
1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ [—á–∞—Å—Ç–æ –∑–∞–¥–∞–≤–∞–µ–º—ã–µ –≤–æ–ø—Ä–æ—Å—ã](../REFERENCES/FAQ.md#auth-issues)
2. –ò–∑—É—á–∏—Ç–µ [–ø—Ä–∏–º–µ—Ä—ã](../REFERENCES/EXAMPLES.md#auth-examples)
3. –°–æ–∑–¥–∞–π—Ç–µ issue –≤ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–∏
4. –û–±—Ä–∞—Ç–∏—Ç–µ—Å—å –∫ Lead SDET Architect
