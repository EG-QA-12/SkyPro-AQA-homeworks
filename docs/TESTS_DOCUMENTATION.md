# Документация по тестам

## Обзор

Фреймворк содержит три уровня тестирования: Smoke, Integration и E2E тесты.

## 1. Smoke-тесты (tests/smoke/)

### Назначение
Smoke-тесты проверяют критически важные функции приложения. Они должны выполняться быстро и быть максимально стабильными.

### Структура бургер-меню тестов

```
tests/smoke/burger_menu/
├── base_burger_menu_test.py      # Базовый класс с общей логикой
├── conftest.py                   # Конфигурация для smoke-тестов
├── left_column/                  # Тесты левой колонки меню
│   └── test_left_column_navigation.py
├── right_column/                 # Тесты правой колонки меню
│   └── test_right_column_navigation.py
└── pages/                        # Page Object классы
    └── burger_menu_page.py
```

### Особенности smoke-тестов бургер-меню:

#### Левая колонка (быстрые тесты):
- **Без визуальных задержек** - максимальная производительность
- **10 тестов** на основные разделы (Новости, Справочная информация, Кодексы и т.д.)
- **Умная валидация URL** - сравнение по ID для docs ссылок, точное совпадение для остальных

#### Правая колонка (тесты с визуальными паузами):
- **Визуальные задержки** для наблюдения процесса тестирования
- **3 теста** на ключевые функции (Личный кабинет, Новые документы, Настройки)
- **Специальная логика** для скрытых элементов правой колонки
- **Fallback стратегии** для надежного клика по элементам

### Базовый класс BaseBurgerMenuNavigationTest

#### Файл: `tests/smoke/burger_menu/base_burger_menu_test.py`

**Общая логика для всех тестов бургер-меню:**

- `_ensure_authenticated()` - проверка и обеспечение авторизации
- `_open_menu_with_retry()` - открытие меню с механизмом повторных попыток
- `_navigate_and_validate()` - унифицированная логика навигации и валидации
- `_navigate_and_validate_docs()` - специальная логика для docs ссылок (сравнение по ID)
- `_navigate_and_validate_right_column()` - логика для правой колонки с визуальными паузами

**Retry механизм:**
- 3 попытки открытия меню
- Автоматическая перезагрузка страницы при неудаче
- Устойчивость к временным сбоям

**Умная валидация URL:**
- Для docs ссылок: сравнение только ID документа (487105)
- Для обычных ссылок: полное совпадение URL
- Поддержка редиректов (301, 302)

## 2. Integration-тесты (tests/integration/)

### Назначение
Integration-тесты проверяют взаимодействие между компонентами системы и внешними сервисами.

### Основные тесты:
- `test_answer_submission.py` - отправка ответов
- `test_auth_quick.py` - быстрая проверка авторизации
- `test_cookie_auth_visual.py` - визуальная проверка cookie-авторизации
- `test_main_page_links.py` - ссылки главной страницы
- `test_publish_answer_api.py` - API публикации ответов

### Особенности:
- **Изоляция через function scope** фикстуры
- **Комплексные проверки** бизнес-логики
- **Интеграция с внешними API**
- **Проверка состояния БД** (при необходимости)

## 3. E2E-тесты (tests/e2e/)

### Назначение
E2E-тесты проверяют полные пользовательские сценарии от начала до конца.

### Структура:
- `base_burger_menu_test.py` - базовый класс для бургер-меню (устаревший)
- `conftest.py` - конфигурация для E2E тестов
- `pages/` - Page Object классы
- `models/` - модели данных

### Особенности:
- **Инфраструктурные файлы** для поддержки других уровней тестирования
- **Заглушки и настройки** для различных окружений
- **Базовые классы** для переиспользования логики

## Запуск тестов

### Smoke-тесты (рекомендуется запускать ежедневно):

```bash
# Все smoke-тесты
pytest tests/smoke/ -v --alluredir=allure-results

# Только бургер-меню
pytest tests/smoke/burger_menu/ -v --alluredir=allure-results

# Левая колонка (быстрые)
pytest tests/smoke/burger_menu/left_column/ -v

# Правая колонка (с визуальными паузами)
pytest tests/smoke/burger_menu/right_column/ -v --headed
```

### Integration-тесты:

```bash
# Все интеграционные тесты
pytest tests/integration/ -v --alluredir=allure-results

# Отдельные компоненты
pytest tests/integration/test_main_page_links.py -v
pytest tests/integration/test_auth_quick.py -v
```

### E2E-тесты (для специальных случаев):

```bash
# Запуск в GUI режиме для отладки
pytest tests/e2e/ -v --headed --slowmo=1000
```

### Быстрые команды:

```bash
# Из корня проекта
scripts/run_tests_quick.bat      # ~15 сек, smoke + основные integration
scripts/run_tests_parallel.bat   # ~20 сек, параллельный запуск
scripts/run_tests_allure.bat     # С генерацией Allure отчета
```

## Стратегия тестирования

### Пирамида тестирования:

```
Smoke Tests (быстрые, критичные)     ████████  ~5-10 мин
Integration Tests (средние, бизнес)   ████      ~15-30 мин
E2E Tests (медленные, комплексные)     ██        ~30-60 мин
```

### Когда запускать каждый уровень:

#### Smoke-тесты:
- **Ежедневно** в CI/CD пайплайнах
- **После каждого коммита** в основную ветку
- **Перед релизом** для финальной проверки
- **При изменениях** в бургер-меню или авторизации

#### Integration-тесты:
- **При изменениях API** или бизнес-логики
- **В CI/CD** для основных проверок
- **При рефакторинге** компонентов системы

#### E2E-тесты:
- **При комплексных изменениях** интерфейса
- **Для исследовательского тестирования**
- **При отладке** сложных багов

## Лучшие практики

### Smoke-тесты:
- **Максимальная скорость** - без лишних задержек
- **Критически важные проверки** - только самое необходимое
- **Высокая стабильность** - минимум flaky-тестов
- **Простая логика** - легко поддерживать и понимать

### Integration-тесты:
- **Изоляция через function scope** фикстуры
- **Комплексные проверки** бизнес-сценариев
- **Интеграция с реальными API** и БД
- **Подробная диагностика** при ошибках

### Общие принципы:
1. **Принцип единственной ответственности** - один тест = одна проверка
2. **Изоляция тестов** - независимость от результатов других тестов
3. **Читаемые имена** - понятные названия тестов и шагов
4. **Автоматическая диагностика** - скриншоты, логи, трассировки при падениях
5. **Устойчивость к сбоям** - retry-механизмы для нестабильных операций
