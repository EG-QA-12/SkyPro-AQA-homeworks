# Справочник pytest фикстур

Этот документ описывает основные фикстуры, доступные во всём проекте. Фикстуры позволяют подготовить и переиспользовать окружение для тестов.

## Глобальные фикстуры (`framework/fixtures/`)

| Фикстура | Модуль | Область | Назначение |
|-----------|--------|---------|------------|
| `auth_user` | `auth_fixtures.py` | function | Создаёт тестового пользователя и авторизует его через API |
| `db_session` | `auth_fixtures.py` | function | Предоставляет подключение к тестовой базе данных с откатом транзакции |

### Пример использования

```python
import pytest

@pytest.mark.db
def test_user_in_db(auth_user, db_session):
    # auth_user — уже авторизован, db_session — открыта
    user = db_session.query(User).get(auth_user.id)
    assert user is not None
```

## Локальные фикстуры (в `tests/**/conftest.py`)

Некоторые директории содержат собственные `conftest.py` для специфичных фикстур. Например:

| Директория | Фикстура | Описание |
|------------|----------|----------|
| `tests/e2e/` | `browser` | Запускает браузер Playwright в режиме, заданном параметрами CLI |
| `tests/auth/` | `cookie_user` | Загружает куки перед тестами авторизации |

> Внутри каждого `conftest.py` есть docstring с подробностями.

## Советы по созданию новых фикстур

1. **Минимизируйте объём работы**: фикстура должна готовить ровно то, что нужно для теста.
2. **Избегайте глобальных побочных эффектов**: если меняете состояние БД, применяйте транзакции и откаты.
3. **Давайте говорящие имена**: чтобы из названия было понятно, что делает фикстура.
4. **Добавляйте типы и docstrings**: это упрощает генерацию документации и понимание кода.

Дополнительные примеры смотрите в исходниках `framework/fixtures/`. 