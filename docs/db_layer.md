# Слой работы с базой данных

Фреймворк предоставляет абстракцию для безопасной работы с базой данных через модуль `framework/db_utils/`.

## Ключевые модули

| Файл | Роль |
|------|------|
| `database_manager.py` | Управление подключениями и пулом соединений |
| `db_config.py` | Хранение параметров подключения (host, port, creds) |
| `security.py` | Шифрование паролей и безопасное хранение секретов |

## Быстрый пример

```python
from framework.db_utils.database_manager import DatabaseManager

with DatabaseManager() as db:
    users = db.fetch_all("SELECT id, login FROM users WHERE active = TRUE")
    print(users)
```

## Полезные советы

1. **Откатывайте транзакции** в тестах, если изменяете данные.
2. **Не храните пароли в коде** — используйте `secrets_manager.py` и переменные окружения.
3. **Проверяйте схемы**: убедитесь, что тестовые данные создаются и удаляются корректно.
4. **Добавляйте индексы** в тестовую БД, если видите узкие места производительности.

## FAQ

**Q:** *Почему мои изменения не видны в других тестах?*

>A: Скорее всего, транзакция ещё не зафиксирована. Используйте `commit()` или фикстуру, которая это делает.

**Q:** *Можно ли подключаться к продовой БД?*

>A: Нет. Тесты должны работать только с тестовой/стейдж окружением, чтобы не повредить реальные данные. 