#!/usr/bin/env python3
"""
–î–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏–æ–Ω–Ω—ã–π —Å–∫—Ä–∏–ø—Ç –Ω–æ–≤–æ–π —Å–∏—Å—Ç–µ–º—ã –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏.

–ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç, –∫–∞–∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –Ω–æ–≤—É—é —Å–∏—Å—Ç–µ–º—É –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏ –≤ –≤–∞—à–∏—Ö —Ç–µ—Å—Ç–∞—Ö.
"""

import sys
from pathlib import Path

# –î–æ–±–∞–≤–ª—è–µ–º –∫–æ—Ä–Ω–µ–≤—É—é –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—é –≤ –ø—É—Ç—å –¥–ª—è –∏–º–ø–æ—Ä—Ç–∞
sys.path.insert(0, str(Path(__file__).parent.parent))

from framework.auth import AuthManager, get_session_cookie, get_auth_cookies


def demo_new_auth_system():
    """–î–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è –Ω–æ–≤–æ–π —Å–∏—Å—Ç–µ–º—ã –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏."""
    print("üöÄ –î–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏—è –Ω–æ–≤–æ–π —Å–∏—Å—Ç–µ–º—ã –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏")
    print("=" * 50)
    
    # 1. –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ AuthManager –Ω–∞–ø—Ä—è–º—É—é
    print("1. –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ AuthManager –Ω–∞–ø—Ä—è–º—É—é:")
    manager = AuthManager()
    
    # –ü–æ–ª—É—á–µ–Ω–∏–µ –∫—É–∫–∏ –¥–ª—è –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞
    admin_cookie = manager.get_session_cookie("admin")
    if admin_cookie:
        print(f"   ‚úÖ –ö—É–∫–∞ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞ –ø–æ–ª—É—á–µ–Ω–∞: {admin_cookie[:30]}...")
    else:
        print("   ‚ö†Ô∏è  –ö—É–∫–∞ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞ –Ω–µ –Ω–∞–π–¥–µ–Ω–∞ "
              "(–ø—Ä–æ–≤–µ—Ä—å—Ç–µ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é)")
    
    # –ü–æ–ª—É—á–µ–Ω–∏–µ –∫—É–∫–∏ –¥–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
    user_cookie = manager.get_session_cookie("user")
    if user_cookie:
        print(f"   ‚úÖ –ö—É–∫–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –ø–æ–ª—É—á–µ–Ω–∞: {user_cookie[:30]}...")
    else:
        print("   ‚ö†Ô∏è  –ö—É–∫–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –Ω–µ –Ω–∞–π–¥–µ–Ω–∞ "
              "(–ø—Ä–æ–≤–µ—Ä—å—Ç–µ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é)")
    
    print()
    
    # 2. –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ —É–¥–æ–±–Ω—ã—Ö —Ñ—É–Ω–∫—Ü–∏–π (–æ–±—Ä–∞—Ç–Ω–∞—è —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å)
    print("2. –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ —É–¥–æ–±–Ω—ã—Ö —Ñ—É–Ω–∫—Ü–∏–π "
          "(–æ–±—Ä–∞—Ç–Ω–∞—è —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å):")
    
    admin_cookie_compat = get_session_cookie("admin")
    if admin_cookie_compat:
        print(f"   ‚úÖ –ö—É–∫–∞ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞ (—Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å): "
              f"{admin_cookie_compat[:30]}...")
    
    # –ü–æ–ª—É—á–µ–Ω–∏–µ –∫—É–∫ –≤ —Ñ–æ—Ä–º–∞—Ç–µ Playwright
    playwright_cookies = get_auth_cookies("admin")
    print(f"   üç™ –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –∫—É–∫ –¥–ª—è Playwright: "
          f"{len(playwright_cookies)}")
    if playwright_cookies:
        print(f"      –ò–º—è –∫—É–∫–∏: {playwright_cookies[0].get('name', 'N/A')}")
        print(f"      –î–æ–º–µ–Ω: {playwright_cookies[0].get('domain', 'N/A')}")
    
    print()
    
    # 3. –†–∞–±–æ—Ç–∞ —Å –∫—ç—à–µ–º
    print("3. –†–∞–±–æ—Ç–∞ —Å –∫—ç—à–µ–º:")
    print(f"   –†–∞–∑–º–µ—Ä –∫—ç—à–∞: {len(manager._cache)}")
    
    # –û—á–∏—Å—Ç–∫–∞ –∫—ç—à–∞ –¥–ª—è –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–π —Ä–æ–ª–∏
    manager.clear_cache("admin")
    print("   ‚úÖ –ö—ç—à –¥–ª—è –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞ –æ—á–∏—â–µ–Ω")
    
    # –ü–æ–ª–Ω–∞—è –æ—á–∏—Å—Ç–∫–∞ –∫—ç—à–∞
    manager.clear_cache()
    print("   ‚úÖ –í–µ—Å—å –∫—ç—à –æ—á–∏—â–µ–Ω")
    
    print()
    
    # 4. –í–∞–ª–∏–¥–∞—Ü–∏—è —Å–µ—Å—Å–∏–∏
    print("4. –í–∞–ª–∏–¥–∞—Ü–∏—è —Å–µ—Å—Å–∏–∏:")
    is_valid = manager.validate_current_session("admin")
    print(f"   –°–µ—Å—Å–∏—è –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞ –≤–∞–ª–∏–¥–Ω–∞: {is_valid}")
    
    print()
    print("‚úÖ –î–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏—è –∑–∞–≤–µ—Ä—à–µ–Ω–∞!")


if __name__ == "__main__":
    demo_new_auth_system()
